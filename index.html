<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mobile App Advanced Streak</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Custom Scrollbar cho ph·∫ßn ch·ªçn Emoji */
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f3f4f6; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        body { background-color: #f3f4f6; padding-bottom: 90px; }
        
        .emoji-select.selected { background-color: #dbeafe; border-color: #3b82f6; transform: scale(1.1); box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.5); }
        
        /* Hi·ªáu ·ª©ng l·ª≠a ch√°y */
        @keyframes fire-pulse {
            0% { transform: scale(1); filter: drop-shadow(0 0 0 rgba(249, 115, 22, 0)); }
            50% { transform: scale(1.2); filter: drop-shadow(0 0 10px rgba(249, 115, 22, 0.5)); }
            100% { transform: scale(1); filter: drop-shadow(0 0 0 rgba(249, 115, 22, 0)); }
        }
        .fire-anim { animation: fire-pulse 2s infinite; }
        
        /* Hi·ªáu ·ª©ng rung l·∫Øc cho h·ªôp qu√† l·ªõn */
        @keyframes shake {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }
        .shake-anim { animation: shake 0.5s ease-in-out infinite; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen bg-gray-50 border-x border-gray-200 shadow-xl relative font-sans">

    <!-- CANVAS ·∫®N ƒê·ªÇ V·∫º ·∫¢NH (K√≠ch th∆∞·ªõc 600x400 px) -->
    <canvas id="shareCanvas" width="600" height="400" style="display: none;"></canvas>

    <!-- Top Bar -->
    <div class="bg-white px-4 py-3 flex justify-between items-center sticky top-0 z-30 shadow-sm">
        <div class="flex items-center gap-3 cursor-pointer" onclick="openProfileModal()">
            <div id="userAvatarDisplay" class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-2xl border-2 border-white shadow-sm">
                üêº
            </div>
            <div>
                <h2 class="text-xs text-gray-500 font-medium">Xin ch√†o,</h2>
                <h3 id="userNameDisplay" class="font-bold text-gray-800 text-sm truncate max-w-[120px]">H·ªçc vi√™n m·ªõi</h3>
            </div>
        </div>
        <div class="flex gap-2">
            <!-- Streak Display -->
            <div id="streakDisplay" class="px-2 py-1 bg-yellow-50 border border-yellow-200 rounded-lg flex items-center gap-1 text-xs font-bold text-yellow-700 transition-all duration-300">
                <i class="fas fa-fire text-orange-500"></i> <span id="streakCountText">0</span>
            </div>
            
            <div class="w-9 h-9 bg-gray-100 rounded-full flex items-center justify-center text-gray-600 relative hover:bg-gray-200 transition">
                <i class="fas fa-bell"></i>
                <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border border-white"></span>
            </div>
        </div>
    </div>

    <!-- Scrollable Content -->
    <div class="p-4 space-y-6">
        
        <!-- Featured Banner -->
        <a href="voca_hsk.html" class="block group relative overflow-hidden rounded-2xl p-5 text-white shadow-lg shadow-blue-200 bg-gradient-to-r from-blue-600 to-indigo-700">
            <div class="absolute right-0 top-0 h-full w-24 bg-white/10 skew-x-12 transform translate-x-10 group-hover:translate-x-5 transition duration-500"></div>
            <div class="relative z-10 flex justify-between items-center">
                <div>
                    <span class="bg-orange-500 text-white text-[10px] px-2 py-0.5 rounded font-bold mb-2 inline-block uppercase tracking-wider">Hot</span>
                    <h3 class="font-bold text-lg">Luy·ªán thi HSK</h3>
                    <p class="text-blue-100 text-xs mt-1 opacity-90">B·ªô ƒë·ªÅ chu·∫©n & T·ª´ v·ª±ng</p>
                </div>
                <div class="text-5xl drop-shadow-md">üèÜ</div>
            </div>
        </a>

        <!-- Section 1: H·ªçc t·∫≠p -->
        <div>
            <div class="flex justify-between items-end mb-3 px-1">
                <h3 class="font-bold text-gray-800">üìö G√≥c H·ªçc T·∫≠p</h3>
                <span class="text-blue-600 text-xs font-semibold">C·ªët l√µi</span>
            </div>
            <div class="flex gap-4 overflow-x-auto no-scrollbar pb-2 px-1">
                <a href="Edubattle.html" class="flex-shrink-0 flex flex-col items-center gap-2 group">
                    <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center text-3xl shadow-sm border border-gray-100 group-hover:scale-105 transition group-hover:border-blue-300">üìú</div>
                    <span class="text-xs font-medium text-gray-700">Ki·ªÉm tra</span>
                </a>
                <a href="study.html" class="flex-shrink-0 flex flex-col items-center gap-2 group">
                    <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center text-3xl shadow-md shadow-blue-200 text-white group-hover:scale-105 transition">üìö</div>
                    <span class="text-xs font-bold text-blue-700">B√†i h·ªçc</span>
                </a>
                <a href="phatam1.html" class="flex-shrink-0 flex flex-col items-center gap-2 group">
                    <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center text-3xl shadow-sm border border-gray-100 group-hover:scale-105 transition group-hover:border-blue-300">üó£Ô∏è</div>
                    <span class="text-xs font-medium text-gray-700">Ph√°t √¢m</span>
                </a>
                <a href="pinyin_practice.html" class="flex-shrink-0 flex flex-col items-center gap-2 group">
                    <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center text-3xl shadow-sm border border-gray-100 group-hover:scale-105 transition group-hover:border-blue-300">ƒÅ</div>
                    <span class="text-xs font-medium text-gray-700">Pinyin</span>
                </a>

                <a href="chineseStroke_micSpace.html" class="flex-shrink-0 flex flex-col items-center gap-2 group">
                    <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center text-3xl shadow-sm border border-gray-100 group-hover:scale-105 transition group-hover:border-blue-300">‚úçÔ∏è</div>
                    <span class="text-xs font-medium text-gray-700">Luy·ªán vi·∫øt</span>
                </a>
            </div>
        </div>

        <!-- Section 2: K·ªπ nƒÉng b·ªï tr·ª£ -->
        <div>
            <h3 class="font-bold text-gray-800 mb-3 px-1">üõ†Ô∏è K·ªπ NƒÉng B·ªï Tr·ª£</h3>
            <div class="space-y-3">
                <a href="SpeakingPro3.html" class="bg-white p-3 rounded-xl shadow-sm flex items-center gap-4 hover:bg-gray-50 transition border border-transparent hover:border-gray-200">
                    <div class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center text-2xl">üé§</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-gray-800 text-sm">Luy·ªán n√≥i AI Pro</h4>
                        <p class="text-gray-400 text-[10px] mt-0.5">C√¥ng ngh·ªá nh·∫≠n di·ªán gi·ªçng n√≥i</p>
                    </div>
                    <i class="fas fa-chevron-right text-gray-300 text-xs"></i>
                </a>
                <a href="Conversation1.html" class="bg-white p-3 rounded-xl shadow-sm flex items-center gap-4 hover:bg-gray-50 transition border border-transparent hover:border-gray-200">
                    <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center text-2xl">üéØ</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-gray-800 text-sm">H·ªôi tho·∫°i m·∫´u</h4>
                        <p class="text-gray-400 text-[10px] mt-0.5">Giao ti·∫øp th·ª±c t·∫ø h√†ng ng√†y</p>
                    </div>
                    <i class="fas fa-chevron-right text-gray-300 text-xs"></i>
                </a>
                <a href="FlashCard_new1.html" class="bg-white p-3 rounded-xl shadow-sm flex items-center gap-4 hover:bg-gray-50 transition border border-transparent hover:border-gray-200">
                    <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center text-2xl">üìñ</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-gray-800 text-sm">Flashcard T·ª´ v·ª±ng</h4>
                        <p class="text-gray-400 text-[10px] mt-0.5">Ph∆∞∆°ng ph√°p ghi nh·ªõ nhanh</p>
                    </div>
                    <i class="fas fa-chevron-right text-gray-300 text-xs"></i>
                </a>
            </div>
        </div>
        
        <!-- Section 3: Game Arcade -->
         <div id="games">
            <h3 class="font-bold text-gray-800 mb-3 px-1 flex items-center gap-2">
                üéÆ Ph√≤ng Tr√≤ Ch∆°i
                <span class="bg-purple-100 text-purple-600 text-[10px] px-2 py-0.5 rounded-full">9 Games</span>
            </h3>
            <div class="grid grid-cols-3 gap-3">
                 <a href="voca_MatchingGame1.html" class="bg-white p-2 py-4 rounded-xl shadow-sm border border-gray-100 text-center hover:shadow-md transition">
                    <div class="text-2xl mb-1">üß©</div>
                    <p class="text-[10px] font-bold text-gray-600">Gh√©p t·ª´</p>
                 </a>
                 <a href="voca_FillBlankGame1.html" class="bg-white p-2 py-4 rounded-xl shadow-sm border border-gray-100 text-center hover:shadow-md transition">
                    <div class="text-2xl mb-1">üìù</div>
                    <p class="text-[10px] font-bold text-gray-600">ƒêi·ªÅn t·ª´</p>
                 </a>
                 <a href="wordGame2.html" class="bg-white p-2 py-4 rounded-xl shadow-sm border border-gray-100 text-center hover:shadow-md transition">
                    <div class="text-2xl mb-1">üî†</div>
                    <p class="text-[10px] font-bold text-gray-600">X·∫øp t·ª´</p>
                 </a>
                 <a href="timso1.html" class="bg-white p-2 py-4 rounded-xl shadow-sm border border-gray-100 text-center hover:shadow-md transition">
                    <div class="text-2xl mb-1">ü•á</div>
                    <p class="text-[10px] font-bold text-gray-600">T√¨m s·ªë</p>
                 </a>
                 <a href="timchu1.html" class="bg-white p-2 py-4 rounded-xl shadow-sm border border-gray-100 text-center hover:shadow-md transition">
                    <div class="text-2xl mb-1">üÄÑ</div>
                    <p class="text-[10px] font-bold text-gray-600">T√¨m ch·ªØ</p>
                 </a>
                 <a href="gheptu_Final.html" class="bg-white p-2 py-4 rounded-xl shadow-sm border border-gray-100 text-center hover:shadow-md transition">
                    <div class="text-2xl mb-1">üà¥</div>
                    <p class="text-[10px] font-bold text-gray-600">Gh√©p H√°n</p>
                 </a>
                 <a href="Hanzi_matchGame1.html" class="bg-white p-2 py-4 rounded-xl shadow-sm border border-gray-100 text-center hover:shadow-md transition">
                    <div class="text-2xl mb-1">üé≥</div>
                    <p class="text-[10px] font-bold text-gray-600">Gh√©p ƒë√¥i</p>
                 </a>
                 <a href="2048_hanzi.html" class="bg-white p-2 py-4 rounded-xl shadow-sm border border-gray-100 text-center hover:shadow-md transition">
                    <div class="text-2xl mb-1">üî¢</div>
                    <p class="text-[10px] font-bold text-gray-600">2048</p>
                 </a>
                 <a href="img_practice1.html" class="bg-white p-2 py-4 rounded-xl shadow-sm border border-gray-100 text-center hover:shadow-md transition">
                    <div class="text-2xl mb-1">üñºÔ∏è</div>
                    <p class="text-[10px] font-bold text-gray-600">H√¨nh ·∫£nh</p>
                 </a>
            </div>
        </div>

    </div>

    <!-- Bottom Tab Bar -->
    <div class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 px-2 py-3 flex justify-around items-center z-40 pb-6 md:pb-3">
        <a href="#" class="flex flex-col items-center gap-1 text-blue-600 w-16">
            <i class="fas fa-home text-xl"></i>
            <span class="text-[10px] font-medium">Home</span>
        </a>
        <a href="study.html" class="flex flex-col items-center gap-1 text-gray-400 hover:text-blue-600 transition w-16">
            <i class="fas fa-book-open text-xl"></i>
            <span class="text-[10px] font-medium">H·ªçc</span>
        </a>
        <a href="#games" class="flex flex-col items-center gap-1 text-gray-400 hover:text-blue-600 transition w-16">
            <i class="fas fa-gamepad text-xl"></i>
            <span class="text-[10px] font-medium">Game</span>
        </a>
        <a href="javascript:void(0)" onclick="openProfileModal()" class="flex flex-col items-center gap-1 text-gray-400 hover:text-blue-600 transition w-16">
            <i class="fas fa-user text-xl"></i>
            <span class="text-[10px] font-medium">T√¥i</span>
        </a>
    </div>

    <!-- STREAK REWARD MODAL -->
    <div id="streakModal" class="fixed inset-0 bg-black/70 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div id="streakContent" class="bg-white rounded-3xl w-full max-w-xs p-8 shadow-2xl text-center transform transition-all scale-95 opacity-0 relative overflow-hidden">
            <!-- Background effects -->
            <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-yellow-50 to-white -z-10"></div>
            <div class="absolute -top-10 -right-10 w-32 h-32 bg-yellow-200 rounded-full opacity-50 blur-xl"></div>
            <div class="absolute -bottom-10 -left-10 w-32 h-32 bg-orange-200 rounded-full opacity-50 blur-xl"></div>

            <div class="mb-4 relative">
                <!-- Icon thay ƒë·ªïi d·ª±a tr√™n ph·∫ßn th∆∞·ªüng -->
                <div id="rewardIconContainer">
                    <i class="fas fa-fire text-6xl text-orange-500 fire-anim drop-shadow-lg"></i>
                </div>
            </div>

            <h2 id="rewardTitle" class="text-2xl font-extrabold text-gray-800 mb-2">Tuy·ªát v·ªùi!</h2>
            <p id="rewardSubtitle" class="text-gray-600 text-sm mb-6">B·∫°n ƒë√£ chƒÉm ch·ªâ h·ªçc t·∫≠p h√¥m nay.</p>

            <!-- Box ph·∫ßn th∆∞·ªüng -->
            <div id="rewardBox" class="bg-orange-50 border border-orange-100 rounded-xl p-3 mb-6 transition-all duration-300">
                <p id="rewardValue" class="text-orange-800 font-bold text-lg flex items-center justify-center gap-2">
                    +1 <i class="fas fa-fire"></i> Steak
                </p>
            </div>
            
            <p id="loginDayCount" class="text-xs text-gray-400 mb-4 font-medium">Ng√†y li√™n ti·∫øp: 1</p>

            <button onclick="closeStreakModal()" class="w-full bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-bold py-3 rounded-xl shadow-lg shadow-orange-200 active:scale-95 transition">
                Ti·∫øp t·ª•c h·ªçc
            </button>
        </div>
    </div>

    <!-- Profile Setup Modal -->
    <div id="profileModal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl transform transition-all scale-95 opacity-0 flex flex-col max-h-[90vh]" id="modalContent">
            <div class="text-center mb-4 flex-shrink-0">
                <h2 class="text-2xl font-bold text-gray-800">H·ªì s∆° h·ªçc vi√™n</h2>
                <p class="text-gray-500 text-sm mt-1">T√πy ch·ªânh c√° nh√¢n h√≥a</p>
            </div>
            
            <!-- Khu v·ª±c ch·ªçn Avatar c√≥ Scroll -->
            <div class="mb-5 flex-1 min-h-0 flex flex-col">
                <label class="block text-xs font-bold text-gray-600 uppercase mb-2 ml-1">Ch·ªçn Avatar</label>
                
                <div class="overflow-y-auto custom-scrollbar p-2 bg-gray-50 border border-gray-100 rounded-2xl flex-1 max-h-60">
                     <div class="grid grid-cols-4 gap-3 justify-items-center" id="emojiGrid"></div>
                </div>
            </div>

            <div class="mb-6 flex-shrink-0">
                <label class="block text-xs font-bold text-gray-600 uppercase mb-2 ml-1">T√™n hi·ªÉn th·ªã</label>
                <input type="text" id="nameInput" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 font-bold text-gray-700 text-center">
            </div>

            <!-- N√∫t Save -->
            <button onclick="saveProfile()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-blue-200 active:scale-95 transition flex-shrink-0 mb-3">
                L∆∞u h·ªì s∆°
            </button>
            
            <!-- N√∫t T·∫£i ·∫¢nh Canvas -->
            <button onclick="downloadProfileCard()" class="w-full bg-white border border-gray-200 hover:bg-gray-50 text-gray-700 font-bold py-2.5 rounded-xl transition flex-shrink-0 text-sm flex items-center justify-center gap-2">
                <i class="fas fa-camera text-blue-500"></i> T·∫£i th·∫ª h·ªçc vi√™n
            </button>
        </div>
    </div>

    <script>
        // --- Logic Streak N√¢ng Cao ---
        function checkDailyStreak() {
            const today = new Date().toLocaleDateString('vi-VN');
            const lastStreakDate = localStorage.getItem('lastStreakDate');
            
            let totalSteaks = parseInt(localStorage.getItem('totalSteaks') || 0);
            let loginDays = parseInt(localStorage.getItem('loginDays') || 0);

            updateStreakUI(totalSteaks);

            if (lastStreakDate !== today) {
                loginDays++;
                localStorage.setItem('loginDays', loginDays);
                localStorage.setItem('lastStreakDate', today);

                let reward = 1;
                let isMilestone = false;

                if (loginDays % 7 === 0) {
                    reward = (loginDays / 7) * 10;
                    isMilestone = true;
                }

                totalSteaks += reward;
                localStorage.setItem('totalSteaks', totalSteaks);

                updateStreakUI(totalSteaks);
                showStreakModal(reward, isMilestone, loginDays);
            }
        }

        function updateStreakUI(count) {
            const display = document.getElementById('streakCountText');
            display.innerText = count;
            
            const container = document.getElementById('streakDisplay');
            if(count > 0) {
                 container.classList.add('bg-orange-100', 'border-orange-300', 'scale-110');
                 setTimeout(() => container.classList.remove('scale-110'), 300);
            }
        }

        function showStreakModal(rewardAmount, isMilestone, currentDay) {
            const modal = document.getElementById('streakModal');
            const content = document.getElementById('streakContent');
            const rewardBox = document.getElementById('rewardBox');
            const rewardTitle = document.getElementById('rewardTitle');
            const rewardSubtitle = document.getElementById('rewardSubtitle');
            const rewardValue = document.getElementById('rewardValue');
            const iconContainer = document.getElementById('rewardIconContainer');
            const loginDayCount = document.getElementById('loginDayCount');

            loginDayCount.innerText = `Ng√†y ƒëƒÉng nh·∫≠p th·ª©: ${currentDay}`;

            if (isMilestone) {
                rewardTitle.innerText = "Si√™u c·∫•p!";
                rewardTitle.classList.add('text-purple-600');
                rewardSubtitle.innerText = `Ch√∫c m·ª´ng c·ªôt m·ªëc ng√†y th·ª© ${currentDay}!`;
                
                rewardValue.innerHTML = `+${rewardAmount} <i class="fas fa-gem text-purple-500"></i> STEAK`;
                rewardBox.classList.remove('bg-orange-50', 'border-orange-100');
                rewardBox.classList.add('bg-purple-50', 'border-purple-200', 'shake-anim', 'scale-110');
                
                iconContainer.innerHTML = '<i class="fas fa-gift text-6xl text-purple-500 drop-shadow-lg animate-bounce"></i>';
            } else {
                rewardTitle.innerText = "Tuy·ªát v·ªùi!";
                rewardTitle.classList.remove('text-purple-600');
                rewardSubtitle.innerText = "B·∫°n ƒë√£ chƒÉm ch·ªâ h·ªçc t·∫≠p h√¥m nay.";
                
                rewardValue.innerHTML = `+${rewardAmount} <i class="fas fa-fire text-orange-500"></i> Steak`;
                rewardBox.classList.add('bg-orange-50', 'border-orange-100');
                rewardBox.classList.remove('bg-purple-50', 'border-purple-200', 'shake-anim', 'scale-110');
                
                iconContainer.innerHTML = '<i class="fas fa-fire text-6xl text-orange-500 fire-anim drop-shadow-lg"></i>';
            }
            
            setTimeout(() => {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    content.classList.remove('scale-95', 'opacity-0');
                    content.classList.add('scale-100', 'opacity-100');
                }, 100);
            }, 1000);
        }

        function closeStreakModal() {
            const modal = document.getElementById('streakModal');
            const content = document.getElementById('streakContent');
            
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // --- Profile Logic ---
        const emojis =[
            // ƒê·ªông v·∫≠t (C≈© + M·ªõi)
            'üêº', 'üê∞', 'üêØ', 'ü¶Å', 'ü¶ä', 'üê∏', 'üê∑', 'üê®', 
            'üêµ', 'üêß', 'üê•', 'ü¶â', 'ü¶Ñ', 'ü¶ã', 'üêô', 'üê¨', 
            'üê≥', 'ü¶ñ', 'üêû', 'üê¢', 'üêù', 'üêå', 'üêò', 'ü¶í',
            'ü¶î', 'üêøÔ∏è', 'ü¶•', 'ü¶¶', 'ü¶á', 'üêπ', 'üê≠', 'üê±',
            'üêï', 'üê©', 'üêà', 'üêÄ', 'ü¶ù', 'üê™', 'ü¶ì', 'ü¶ç',
            'ü¶è', 'ü¶õ', 'ü¶É', 'üêì', 'üê£', 'ü¶¢', 'ü¶ú', 'ü¶©',
            'ü¶ö', 'üêä', 'ü¶é', 'üêç', 'ü¶à', 'üê†', 'üê°', 'ü¶û',
            'ü¶ê', 'ü¶ë', 'ü¶ï', 'ü¶å', 'üêê', 'üêè', 'üêë', 'üêé',
            'üêñ', 'üêÑ', 'üêÇ', 'üêÉ', 'ü¶ò',
            
            // Bi·ªÉu c·∫£m vui nh·ªôn & M·∫∑t c∆∞·ªùi
            'ü§™', 'ü•≥', 'üòé', 'ü§ì', 'ü§†', 'üëª', 'üëΩ', 'ü§ñ',
            'üëæ', 'üí©', 'ü§°', 'üë∫', 'üëπ', 'üëø', 'üíÄ', '‚ò†Ô∏è',
            'üò∫', 'üò∏', 'üòπ', 'üòª', 'üòº', 'üòΩ', 'üôÄ', 'üòø',
            'üòæ', 'üôà', 'üôâ', 'üôä', 'ü•∫', 'ü•¥', 'ü§Ø', 'ü•∂',
            
            // ƒê·ªì ƒÉn & V·∫≠t ph·∫©m d·ªÖ th∆∞∆°ng
            'üçî', 'üçï', 'üçü', 'üå≠', 'üçø', 'üç©', 'üç™', 'üéÇ',
            'üßÅ', 'üç¶', 'üçß', 'üç°', 'üç≠', 'üç¨', 'üç´', 'ü•ë',
            'üçì', 'üçí', 'üçë', 'üçç', 'ü••', 'ü•ù', 'üçâ', 'üçÑ',
            'üéà', 'üéÅ', 'üéÄ', 'üéâ', 'üéä', 'üß∏', 'ü™Å', 'üîÆ',
            'üé®', 'üöÄ', 'üõ∏', '‚≠ê', 'üåü', '‚ú®', 'üåà', 'üçÄ',
            '‚öΩ', 'üèÄ', 'üéÆ', 'üé≤', 'üéØ', 'üèÜ', 'ü•á', 'üíé',
            
            // Th·ªÉ thao & Ho·∫°t ƒë·ªông
            'üèà', 'üéæ', 'üèê', 'üèâ', 'üé±', 'üèì', 'üè∏', 'üèí',
            'ü•ä', 'ü•ã', 'üé£', 'üèãÔ∏è', 'üö¥', 'ü§∏', '‚õπÔ∏è', 'ü§∫',
            
            // Thi√™n nhi√™n & C√¢y c·ªëi
            'üåµ', 'üå≤', 'üå≥', 'üå¥', 'üåπ', 'üåª', 'üåº', 'üå∑',
            'üçÅ', 'üçÇ', 'üçÑ', 'üåç', 'üåï', 'üåô', 'üåä', 'üåã',
            
            // Ph∆∞∆°ng ti·ªán
            'üöó', 'üöï', 'üöô', 'üöå', 'üöì', 'üöë', 'üöí', 'üö≤',
            'üõµ', 'üèçÔ∏è', 'üöÇ', '‚úàÔ∏è', 'üö§', 'üöÅ', 'üöú', 'üõ≥Ô∏è',
            
            // Tr√°i tim & C·∫£m x√∫c
            '‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üñ§', 'ü§ç',
            'ü§é', 'üíî', '‚ù£Ô∏è', 'üíï', 'üíû', 'üíì', 'üíó', 'üíñ'
        ];

        let selectedEmoji = 'üêº';

        const modal = document.getElementById('profileModal');
        const modalContent = document.getElementById('modalContent');
        const emojiGrid = document.getElementById('emojiGrid');
        const nameInput = document.getElementById('nameInput');
        const userAvatarDisplay = document.getElementById('userAvatarDisplay');
        const userNameDisplay = document.getElementById('userNameDisplay');

        emojis.forEach(emoji => {
            const div = document.createElement('div');
            div.className = `emoji-select w-11 h-11 rounded-full bg-white flex items-center justify-center text-xl cursor-pointer border border-gray-200 shadow-sm transition-all hover:bg-blue-50 hover:border-blue-200 hover:scale-105 ${emoji === selectedEmoji ? 'selected' : ''}`;
            div.textContent = emoji;
            div.onclick = () => selectEmoji(div, emoji);
            emojiGrid.appendChild(div);
        });

        function selectEmoji(element, emoji) {
            document.querySelectorAll('.emoji-select').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedEmoji = emoji;
        }

        function openProfileModal() {
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
            
            const storedName = localStorage.getItem('username');
            const storedAvatar = localStorage.getItem('avatar');
            if (storedName) nameInput.value = storedName;
            if (storedAvatar) {
                selectedEmoji = storedAvatar;
                const items = document.querySelectorAll('.emoji-select');
                items.forEach(el => {
                    el.classList.remove('selected');
                    if (el.textContent === storedAvatar) el.classList.add('selected');
                });
            }
        }

        function closeProfileModal() {
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function saveProfile() {
            const name = nameInput.value.trim() || "H·ªçc vi√™n";
            localStorage.setItem('username', name);
            localStorage.setItem('avatar', selectedEmoji);
            updateUI();
            closeProfileModal();
        }

        function updateUI() {
            const storedName = localStorage.getItem('username');
            const storedAvatar = localStorage.getItem('avatar');

            if (storedName) userNameDisplay.textContent = storedName;
            if (storedAvatar) userAvatarDisplay.textContent = storedAvatar;
        }

        // --- T√çNH NƒÇNG V·∫º V√ÄO CANVAS (M·ªöI) ---
        function downloadProfileCard() {
            const canvas = document.getElementById('shareCanvas');
            const ctx = canvas.getContext('2d');
            const name = localStorage.getItem('username') || "H·ªçc vi√™n";
            const avatar = localStorage.getItem('avatar') || "üêº";
            const streak = localStorage.getItem('totalSteaks') || 0;

            // 1. V·∫Ω n·ªÅn Gradient
            const gradient = ctx.createLinearGradient(0, 0, 600, 400);
            gradient.addColorStop(0, '#3b82f6'); // Blue 500
            gradient.addColorStop(1, '#6366f1'); // Indigo 500
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 600, 400);

            // 2. V·∫Ω h√¨nh tr√≤n n·ªÅn cho Avatar
            ctx.beginPath();
            ctx.arc(300, 150, 80, 0, 2 * Math.PI, false); // T√¢m x=300, y=150, R=80
            ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.fill();
            ctx.lineWidth = 5;
            ctx.strokeStyle = 'white';
            ctx.stroke();

            // 3. V·∫Ω Avatar (Emoji)
            ctx.font = '100px Arial'; // Emoji size
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = 'white';
            ctx.fillText(avatar, 300, 155);

            // 4. V·∫Ω T√™n
            ctx.font = 'bold 36px sans-serif';
            ctx.fillStyle = 'white';
            ctx.fillText(name, 300, 260);

            // 5. V·∫Ω Streak
            ctx.font = '24px sans-serif';
            ctx.fillStyle = '#fef08a'; // Yellow 200
            ctx.fillText(`üî• Th√†nh t√≠ch: ${streak} Steak`, 300, 310);

            // 6. V·∫Ω Footer Text
            ctx.font = 'italic 16px sans-serif';
            ctx.fillStyle = 'rgba(255,255,255,0.7)';
            ctx.fillText('Mobile App Advanced Learning', 300, 370);

            // 7. T·∫°o link t·∫£i v·ªÅ
            const link = document.createElement('a');
            link.download = `The-Hoc-Vien-${name.replace(/\s+/g, '-')}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        // --- Initialization ---
        window.addEventListener('load', () => {
            if (!localStorage.getItem('username')) {
                setTimeout(openProfileModal, 500);
            } else {
                updateUI();
                checkDailyStreak(); 
            }
        });

        const originalSaveProfile = saveProfile;
        saveProfile = function() {
            originalSaveProfile();
            checkDailyStreak();
        }

        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeProfileModal();
        });
    </script>
</body>
</html>